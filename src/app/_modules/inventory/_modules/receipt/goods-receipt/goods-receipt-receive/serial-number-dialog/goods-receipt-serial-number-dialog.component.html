<p-dialog [(visible)]="display" [contentStyle]="{'overflow':'visible'}" [modal]="true" [responsive]="true"
  [style]="{width: '90%'}" appendTo="body">
  <p-header>
    <div class="row">
      <div class="col-sm-3">
        <span class="dialog-header">{{'goodsReceiptDetail.qrCode.title ' | translate}}: {{extendTitle}}</span>
      </div>
      <div class="col-sm-9">
        <div class="page-actions d-flex justify-content-end">
          <button (click)="clearSerialNumberTable(tableSerialNumber)" class="btn btn-labeled btn-clear mr-2"
            data-qe-id="button-clear">
            <span class="btn-label">
              <img src="/assets/img/filter.svg" width="16">
            </span>
            <span class="button-label">
              {{'general.button.clear' | translate}}
            </span>
          </button>
          <button (click)="deleteMultipleSerialNumber()" class="btn btn-labeled btn-delete">
            <span class="btn-label"><i class="material-icons">delete</i></span>
            <span class="button-label">
              {{'general.button.delete' | translate}}
            </span></button>
        </div>
      </div>
    </div>
  </p-header>
  <div class="dialog-body">
    <div class="row">
      <div class="col-sm-6">
        <div class="d-flex align-items-center">
          <p-inputSwitch [(ngModel)]="activeScan"></p-inputSwitch>
          <span class="ml-2">{{'goodsReceiptDetail.qrCode.scanQRCode' | translate}}</span>
          <div class="ml-2 col-sm-9">
            <input (change)="inputSerialNumber($event.target.value)" [(ngModel)]="qrCode" [disabled]="!activeScan"
              class="form-control" data-qe-id="dialog-input-start-scan-batches-no" type="text">
          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div *ngIf="enableBinLocation" class="d-flex align-items-center justify-content-end">
          <span class="mr-2">{{'goodsReceiptDetail.binLocation' | translate}}: </span>
          <div class="ml-2">
            <jaja-select-list [getList]="serialNumberDialogRepository.getBinLocationList"
              (change)="selectBinLocation($event)" [searchEntity]="binLocationSearchEntity" [searchable]="true"
              appendTo="body" searchField="code">
              <ng-template #label #option let-code="code">
                {{code}}
              </ng-template>
            </jaja-select-list>
          </div>
        </div>
      </div>
      <div class="col-sm-12 mt-2">
        <div class="d-flex align-items-center justify-content-end">
          <span class="ml-2">{{'goodsReceiptDetail.qrCode.quantity' | translate}}: </span>
          <div class="ml-2">
            <input [ngModel]="goodsReceiptContent.quantity" class="form-control disabled"
              data-qe-id="dialog-input-start-scan-batches-no" type="text">
          </div>
        </div>
      </div>
      <div class="col-sm-12 mt-2">
        <div class="d-flex align-items-center justify-content-end">
          <span class="ml-2">{{'goodsReceiptDetail.qrCode.actualReceive' | translate}}: </span>
          <div class="ml-2">
            <input [value]="goodsReceiptContent.goodsReceiptSerialNumbers?.length" class="form-control disabled"
              data-qe-id="dialog-input-start-scan-batches-no" type="text">
          </div>
        </div>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-sm-12">
        <p-table #tableSerialNumber *ngIf="enableBinLocation" [resizableColumns]="true" [scrollable]="true"
          [value]="goodsReceiptContent.goodsReceiptSerialNumbers" resizableColumns scrollHeight="300px">
          <ng-template pTemplate="colgroup">
            <colgroup>
              <col width="80px">
              <col>
              <col>
              <col>
              <col>
              <col>
              <col width="100px">
            </colgroup>
          </ng-template>
          <ng-template pTemplate="header">
            <tr>
              <th data-qe-id="table-thead-qrCode-check-box">
                <div class="pretty p-icon p-curve p-has-indeterminate">
                  <input (change)="checkAllSerialNumber($event.target)" type="checkbox" />
                  <div class="state">
                    <i class="icon material-icons">done</i>
                    <label></label>
                  </div>
                </div>
              </th>
              <th data-qe-id="table-thead-qrCode-code" pResizableColumn>
                {{'goodsReceiptDetail.qrCode.code' | translate}}
              </th>
              <th data-qe-id="table-thead-qrCode-serialNumber" pResizableColumn>
                {{'goodsReceiptDetail.qrCode.serial' | translate}}
              </th>
              <th data-qe-id="table-thead-qrCode-manufacturing-date" pResizableColumn>
                {{'goodsReceiptDetail.qrCode.manufacturingDate' | translate}}
              </th>
              <th data-qe-id="table-thead-qrCode-expiry-date" pResizableColumn>
                {{'goodsReceiptDetail.qrCode.expiryDate' | translate}}
              </th>
              <th data-qe-id="table-thead-qrCode-location-code" pResizableColumn>
                {{'goodsReceiptDetail.qrCode.locationCode' | translate}}
              </th>
              <th data-qe-id="table-thead-qrCode-action" width="5%">
                {{'general.action' | translate}}
              </th>
            </tr>
            <tr>
              <th class="th-filter"></th>
              <th class="th-filter">
                <input (change)="tableSerialNumber.filter($event.target.value, 'qrCode', 'startsWith')"
                  [(ngModel)]="goodsReceiptContentSearch.qrCode" class="form-control w-100" pKeyFilter="int"
                  type="text" />
              </th>
              <th class="th-filter">
                <input (input)="tableSerialNumber.filter($event.target.value, 'serialNumber', 'startsWith')"
                  [(ngModel)]="goodsReceiptContentSearch.serialNumber" class="form-control w-100" pKeyFilter="int"
                  type="text" />
              </th>
              <th class="th-filter">
                <app-date-picker (valueChange)="sortDate($event, tableSerialNumber, 'mfrDate')"
                  data-qe-id="detail-form-receipted-date">
                </app-date-picker>
              </th>
              <th class="th-filter">
                <app-date-picker (valueChange)="sortDate($event, tableSerialNumber, 'expirationDate')"
                  data-qe-id="detail-form-receipted-date">
                </app-date-picker>
              </th>
              <th class="th-filter"></th>
              <th class="th-filter"></th>
            </tr>
          </ng-template>
          <ng-template let-index="rowIndex" let-serialNumber pTemplate="body">
            <tr>
              <td>
                <div class="pretty p-icon p-curve p-has-indeterminate">
                  <input [(ngModel)]="serialNumber.isSelected" type="checkbox" />
                  <div class="state">
                    <i class="icon material-icons">done</i>
                    <label></label>
                  </div>
                </div>
              </td>
              <td class="ui-resizable-column">
                <input [(ngModel)]="serialNumber.qrCode" class="form-control w-100" type="text" />
              </td>
              <td class="ui-resizable-column">
                <input [(ngModel)]="serialNumber.serialNumber" class="form-control w-100" type="text" />
              </td>
              <td class="ui-resizable-column">
                <app-date-picker (valueChange)="serialNumber.mfrDate = $event" data-qe-id="detail-form-receipted-date"
                  [model]="serialNumber.mfrDate">
                </app-date-picker>
              </td>
              <td class="ui-resizable-column">
                <app-date-picker (valueChange)="serialNumber.expirationDate = $event"
                  [model]="serialNumber.expirationDate" data-qe-id="detail-form-receipted-date">
                </app-date-picker>
              </td>
              <td class="ui-resizable-column">
                <jaja-select-list [getList]="serialNumberDialogRepository.getBinLocationList"
                  [display]="serialNumber.binLocationCode" (change)="serialNumber.binLocationId = $event?.id"
                  [searchEntity]="binLocationSearchEntity" [searchable]="true" [small]="true" appendTo="body"
                  searchField="code" searchType="startsWith">
                  <ng-template #label #option let-code="code">
                    {{code}}
                  </ng-template>
                </jaja-select-list>
              </td>
              <td class="text-center" width="5%">
                <mat-icon (click)="deleteSerialNumber(index)" class="text-danger">delete</mat-icon>
              </td>
            </tr>
          </ng-template>
          <ng-template pTemplate="footer" *ngIf="!activeScan">
            <tr>
              <td colspan="2" class="text-right">
                <a href="javascript:;" (click)="addSerialNumber()">+
                  {{'general.button.addRow' | translate}}</a>
              </td>
              <td colspan="5"></td>
            </tr>
          </ng-template>
        </p-table>
      </div>
    </div>
  </div>
  <p-footer>
    <div class="row">
      <div class="col-sm-12">
        <div class="page-actions d-flex justify-content-end">
          <button (click)="update()" class="btn btn-labeled btn-save-dialog">
            <span class="btn-label"><i class="material-icons">save</i></span>
            <span class="button-label">
              {{'general.button.save' | translate}}
            </span></button>
          <button (click)="cancel()" class="btn btn-labeled btn-cancel">
            <span class="btn-label"><i class="material-icons"> highlight_off</i></span>
            <span class="button-label">
              {{'general.button.cancel' | translate}}
            </span></button>
        </div>
      </div>
    </div>
  </p-footer>
</p-dialog>