<div class="page goods-receipt-po">
  <div class="page-header justify-content-between">
    <div class="justify-content-start align-items-center">
            <span (click)="backToList()" class="back-to-list">
                <i class="material-icons">arrow_back_ios</i>
            </span>
      <span class="page-title">
                {{pageTitle | translate}}
            </span>
      <span *ngIf="goodsReceiptPOForm.controls.statusName.value === 'PENDING_APPROVAL'"
            class="ml-2 pending-status">{{'general.pending'| translate}}</span>
      <span *ngIf="goodsReceiptPOForm.controls.statusName.value === 'DONE'"
            class="ml-2 done-status">{{'general.done'| translate}}</span>
    </div>
    <div class="page-actions d-flex">
      <button (click)="approve()" *ngIf="goodsReceiptPOForm.controls.statusName.value === 'PENDING_APPROVAL'"
              class="btn btn-labeled btn-approve"
              data-qe-id="button-approve">
        <span class="btn-label"><i class="material-icons">check</i></span>
        <span class="button-label">
                    {{'general.button.approve' | translate}}
                </span>
      </button>
      <button (click)="reject()" *ngIf="goodsReceiptPOForm.controls.statusName.value === 'PENDING_APPROVAL'"
              class="btn btn-labeled btn-rejected"
              data-qe-id="button-rejected">
        <span class="btn-label"><i class="material-icons">block</i></span>
        <span class="button-label">
                    {{'general.button.rejected' | translate}}
                </span>
      </button>
      <div class="btn-group btn-labeled" data-qe-id="button-action" dropdown>
        <button aria-controls="dropdown-basic" class="btn btn-labeled btn-import" dropdownToggle
                id="button-basic">
          <span class="btn-label"><i class="material-icons">arrow_drop_down</i></span>
          <span class="button-label">
                        {{'general.action' | translate}}
                    </span></button>
        <ul *dropdownMenu aria-labelledby="button-basic" class="dropdown-menu dropdown-menu-right" id="dropdown-basic"
            role="menu">
          <li role="menuitem">
            <a class="dropdown-item" href="#">{{'general.button.history' | translate}}</a>
          </li>
          <li class="divider dropdown-divider"></li>
          <li role="menuitem">
            <a class="dropdown-item" href="#">{{'general.button.print' | translate}}</a>
          </li>
          <li class="divider dropdown-divider"></li>
          <li role="menuitem">
            <a class="dropdown-item" href="#">{{'general.button.referenceDocument' | translate}}</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div [formGroup]="goodsReceiptPOForm" class="page-body">
    <div class="page-section">
      <div class="page-section-form-header">
                <span class="form-title">
                    {{'goodsReceiptPODetail.form.title' | translate}}
                </span>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.supplierCode' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-supplierCode" formControlName="supplierCode"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.supplierName' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-supplier-name" formControlName="supplierName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.supplierAddress' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-supplier-name"
                   formControlName="supplierAddress"
                   type="text">
          </div>
        </div>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-8 form-group">
            <label>
              {{'goodsReceiptPODetail.goodsReceipt.title' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-goods-receipt"
                   formControlName="purchaseOrderName"
                   type="text">
          </div>
        </div>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.purchaseOrderNumber' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-documentNumber"
                   formControlName="documentNumber"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.inventoryCode' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-inventoryOrganizationCode"
                   formControlName="inventoryOrganizationCode"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.inventoryAddress' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-inventory-code"
                   formControlName="inventoryOrganizationStreet"
                   type="text">
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.personInCharge' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-ownerName" formControlName="ownerName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.receiver' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-buyerName" formControlName="buyerName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.creator' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-creator" formControlName="requesterName"
                   type="text">
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.receiptedDate' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <app-date-picker [control]="goodsReceiptPOForm.get('dueDate')" [disabled]="true"
                             data-qe-id="detail-form-dueDate">
            </app-date-picker>
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.createdDate' | translate}}
            </label>
            <app-date-picker [control]="goodsReceiptPOForm.get('documentDate')"
                             [disabled]="true" data-qe-id="detail-form-documentDate">
            </app-date-picker>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 form-group">
            <label>{{ 'goodsReceiptPODetail.description' | translate}}</label>
            <textarea class="form-control disabled" data-qe-id="detail-form-remarks" formControlName="remarks"
                      rows="4">
                         </textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="page-section">
      <div class="tab-header pt-3 pb-3 pl-3 pr-3">
        <mat-tab-group>
          <mat-tab label="{{'goodsReceiptPODetail.goodsReceiptPOContents.title' | translate}}">
            <div class="table pt-3">
              <p-table #tableGoodsReceiptPOContents [resizableColumns]="true" [scrollable]="true"
                       [value]="goodsReceiptPOForm.controls.goodsReceiptPOContents.value"
                       scrollHeight="500px">
                <ng-template pTemplate="colgroup">
                  <colgroup>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                  </colgroup>
                </ng-template>
                <ng-template pTemplate="header">
                  <tr>
                    <th data-qe-id="table-thead-purchase-order-number" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.purchaseOrderNumber' | translate}}
                    </th>
                    <th data-qe-id="table-thead-item-no" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.itemNo' | translate}} </th>
                    <th data-qe-id="table-thead-purchase-order-number" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.itemName' | translate}} </th>
                    <th data-qe-id="table-thead-unit-of-measure" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.unitOfMeasure' | translate}}
                    </th>
                    <th data-qe-id="table-thead-quantity" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.quantity' | translate}} </th>
                    <th data-qe-id="table-thead-unit-of-measure" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.unitPrice' | translate}}
                    </th>
                    <th data-qe-id="table-thead-value-added-tax" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.valueAddedTax' | translate}}
                      (%)
                    </th>
                    <th data-qe-id="table-thead-discount" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.discount' | translate}} (%)
                    </th>
                    <th data-qe-id="table-thead-discount-amount" pResizableColumn>
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.discountAmount' | translate}}
                    </th>
                    <th class="value">
                      {{'goodsReceiptPODetail.goodsReceiptPOContents.total' | translate}}
                    </th>
                  </tr>
                  <tr>
                    <th class="th-filter">
                      <jaja-select-list [getList]="goodsReceiptPOApproveRepository.getDocumentNumberList"
                                        [searchEntity]="documentNumberSearchEntity"
                                        searchField="documentNumber"
                                        searchType="startsWith"
                                        [searchable]="true"
                                        appendTo="body"
                                        placeholder="{{'goodsReceiptPODetail.goodsReceiptPOContents.purchaseOrderNumber' | translate}}"
                      ></jaja-select-list>
                    </th>
                    <th class="th-filter">
                      <jaja-select-list [getList]="goodsReceiptPOApproveRepository.getItemDetailList"
                                        [renewOnOpen]="true"
                                        [searchEntity]="itemDetailSearchEntity"
                                        [searchable]="true"
                                        appendTo="body"
                                        placeholder="{{'goodsReceiptPODetail.goodsReceiptPOContents.itemCode' | translate}}"
                                        searchField="code"
                                        searchType="startsWith">
                        <ng-template #label #option let-code="code" let-name="name">
                          {{name}} ({{code}})
                        </ng-template>
                      </jaja-select-list>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'itemName', 'contains')"
                             class="form-control w-100"
                             type="text"/>
                    </th>
                    <th class="th-filter">
                      <jaja-select-list (change)="tableGoodsReceiptPOContents.filter($event.target.value, 'unitPrice', 'startsWith')"
                                        [getList]="goodsReceiptPOApproveRepository.getUnitOfMeasureList"
                                        [renewOnOpen]="true"
                                        [searchEntity]="unitOfMeasureSearchEntity"
                                        [searchable]="true"
                                        appendTo="body"
                                        placeholder="{{'goodsReceiptPODetail.goodsReceiptPOContents.unitPrice' | translate}}"
                                        searchField="code"
                                        searchType="startsWith">
                        <ng-template #label #option let-code="code" let-name="name">
                          {{name}} ({{code}})
                        </ng-template>
                      </jaja-select-list>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'quantity', 'equals')"
                             class="form-control w-100" pKeyFilter="int"
                             type="text"/>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'taxRate', 'equals')"
                             class="form-control w-100" pKeyFilter="int"
                             type="text"/>
                    </th>
                    <th class="th-filter">
                      <jaja-select-list [getList]="goodsReceiptPOApproveRepository.getTaxList"
                                        [renewOnOpen]="true"
                                        [searchEntity]="valueAddedTaxSearchEntity"
                                        [searchable]="true"
                                        appendTo="body"
                                        placeholder="{{'goodsReceiptPODetail.goodsReceiptPOContents.valueAddedTax' | translate}}"
                                        searchField="code"
                                        searchType="startsWith">
                        <ng-template #label #option let-code="code" let-name="name">
                          {{name}} ({{code}})
                        </ng-template>
                      </jaja-select-list>
                    </th>
                    <th class="th-filter">
                      <input
                        (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'generalDiscountRate', 'equals')"
                        class="form-control w-100" pKeyFilter="int"
                        type="text"/>
                    </th>
                    <th class="th-filter">
                      <input
                        (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'generalDiscountCost', 'equals')"
                        class="form-control w-100" pKeyFilter="int"
                        type="text"/>
                    </th>
                    <th class="th-filter value"></th>
                  </tr>
                </ng-template>
                <ng-template let-goodsReceiptPOContent let-index="rowIndex" pTemplate="body">
                  <tr>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.documentNumber}}</td>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.itemCode}}</td>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.itemName}}</td>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.unitOfMeasureName}}</td>
                    <td class="ui-resizable-column">
                      {{goodsReceiptPOContent.quantity}}
                    </td>
                    <td class="ui-resizable-column text-right">{{goodsReceiptPOContent.unitPrice}}
                    </td>
                    <td class="ui-resizable-column text-right">{{goodsReceiptPOContent.taxRate}}
                    </td>
                    <td class="ui-resizable-column text-right">
                      {{goodsReceiptPOContent.itemDiscountRate}}
                    </td>
                    <td class="ui-resizable-column text-right">
                      {{goodsReceiptPOContent.itemDiscountCost}}
                    </td>
                    <td class="text-right value">
                      {{goodsReceiptPOContent.total}}
                    </td>
                  </tr>
                </ng-template>
                <ng-template let-columns pTemplate="footer">
                  <tr>
                    <td class="text-right" colspan="9">{{'general.text.total' | translate}}:</td>
                    <td class="text-right value">
                      {{ goodsReceiptPOForm.controls.totalGoodsReceiptPOContents.value | number}}
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </mat-tab>
          <mat-tab label="{{'goodsReceiptPODetail.goodsReceiptPOAttachments.title' | translate}}">
            <div class="tab-upload">
              <nz-upload
                [nzDisabled]="true"
                [nzFileList]="fileAttachments.value"
                [nzLimit]="0"
                [nzMultiple]="true"
                nzType="drag">
                <p class="ant-upload-drag-icon">
                  <i nz-icon nzType="upload"></i>
                </p>
                <p class="ant-upload-text">
                  {{'goodsReceiptPODetail.attachments.title' | translate}}
                </p>
                <p class="ant-upload-hint">
                  {{'goodsReceiptPODetail.attachments.description' | translate}}
                </p>
              </nz-upload>

              <button class="btn btn-labeled btn-send mt-2" disabled>
                <span class="btn-label">
                  <i class="material-icons">cloud_upload</i>
                </span>
                <span class="button-label">
                  {{'general.button.upload' | translate}}
                </span>
              </button>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>

    <div *ngIf="goodsReceiptPOId !== null && goodsReceiptPOId !== undefined" class="page-section">
      <div class="page-section-form-header">
                <span class="form-title">
                    {{'goodsReceiptPODetail.form.post.title' | translate}}
                </span>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <app-discussion [discussionId]="goodsReceiptPOId"></app-discussion>
      </div>
    </div>
  </div>
</div>
