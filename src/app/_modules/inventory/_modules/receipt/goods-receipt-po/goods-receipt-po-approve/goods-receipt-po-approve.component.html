<div class="page goods-receipt-po">
  <div class="page-header justify-content-between">
    <div class="justify-content-start align-items-center">
            <span (click)="backToList()" class="back-to-list">
                <i class="material-icons">arrow_back_ios</i>
            </span>
      <span class="page-title">
                {{pageTitle | translate}}
            </span>
      <span *ngIf="goodsReceiptPOForm.controls.statusName.value === 'PENDING_APPROVAL'"
            class="ml-2 pending-status">{{'general.pending'| translate}}</span>
      <span *ngIf="goodsReceiptPOForm.controls.statusName.value === 'DONE'"
            class="ml-2 done-status">{{'general.done'| translate}}</span>
    </div>
    <div class="page-actions d-flex">
      <button (click)="approve()" *ngIf="goodsReceiptPOForm.controls.statusName.value === 'PENDING_APPROVAL'" class="btn btn-labeled btn-approve"
              data-qe-id="button-approve">
        <span class="btn-label"><i class="material-icons">check</i></span>
        <span class="button-label">
                    {{'general.button.approve' | translate}}
                </span>
      </button>
      <button (click)="reject()" *ngIf="goodsReceiptPOForm.controls.statusName.value === 'PENDING_APPROVAL'" class="btn btn-labeled btn-rejected"
              data-qe-id="button-rejected">
        <span class="btn-label"><i class="material-icons">block</i></span>
        <span class="button-label">
                    {{'general.button.rejected' | translate}}
                </span>
      </button>
      <div class="btn-group btn-labeled" data-qe-id="button-action" dropdown>
        <button aria-controls="dropdown-basic" class="btn btn-labeled btn-import" dropdownToggle
                id="button-basic">
          <span class="btn-label"><i class="material-icons">arrow_drop_down</i></span>
          <span class="button-label">
                        {{'general.action' | translate}}
                    </span></button>
        <ul *dropdownMenu aria-labelledby="button-basic" class="dropdown-menu dropdown-menu-right" id="dropdown-basic"
            role="menu">
          <li role="menuitem">
            <a class="dropdown-item" href="#">{{'general.button.history' | translate}}</a>
          </li>
          <li class="divider dropdown-divider"></li>
          <li role="menuitem">
            <a class="dropdown-item" href="#">{{'general.button.print' | translate}}</a>
          </li>
          <li class="divider dropdown-divider"></li>
          <li role="menuitem">
            <a class="dropdown-item" href="#">{{'general.button.referenceDocument' | translate}}</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div [formGroup]="goodsReceiptPOForm" class="page-body">
    <div class="page-section">
      <div class="page-section-form-header">
                <span class="form-title">
                    {{'goodsReceiptPODetail.form.title' | translate}}
                </span>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.supplierCode' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-supplierCode" formControlName="supplierCode"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.supplierName' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-supplier-name" formControlName="supplierName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.supplierAddress' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-supplier-name" formControlName="supplierAddress"
                   type="text">
          </div>
        </div>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-8 form-group">
            <label>
              {{'goodsReceiptPODetail.goodsReceipt.title' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-goods-receipt" formControlName="purchaseOrderName"
                   type="text">
          </div>
        </div>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.documentNumber' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-documentNumber" formControlName="documentNumber"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.inventoryCode' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-inventoryOrganizationCode"
                   formControlName="inventoryOrganizationCode"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.inventoryAddress' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-inventory-code" formControlName="inventoryOrganizationStreet"
                   type="text">
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.personInCharge' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-ownerName" formControlName="ownerName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.receiver' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-buyerName" formControlName="buyerName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.creator' | translate}}
            </label>
            <input class="form-control disabled" data-qe-id="detail-form-creator" formControlName="requesterName"
                   type="text">
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.receiptedDate' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <app-date-picker [control]="goodsReceiptPOForm.get('dueDate')" [disabled]="true"
                             data-qe-id="detail-form-dueDate">
            </app-date-picker>
          </div>
          <div class="col-sm-4 form-group">
            <label>
              {{'goodsReceiptPODetail.createdDate' | translate}}
            </label>
            <app-date-picker [control]="goodsReceiptPOForm.get('documentDate')"
                             [disabled]="true" data-qe-id="detail-form-documentDate">
            </app-date-picker>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 form-group">
            <label>{{ 'goodsReceiptPODetail.description' | translate}}</label>
            <textarea class="form-control disabled" data-qe-id="detail-form-remarks" formControlName="remarks"
                      rows="4">
                         </textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="page-section">
      <div class="tab-header pt-3 pb-3 pl-3 pr-3">
        <mat-tab-group>
          <mat-tab label="{{'goodsReceiptPODetail.tab1.title' | translate}}">
            <div class="table pt-3">
              <p-table #tableGoodsReceiptPOContents [resizableColumns]="true" [scrollable]="true"
                       [value]="goodsReceiptPOForm.controls.goodsReceiptPOContents.value"
                       scrollHeight="500px">
                <ng-template pTemplate="colgroup">
                  <colgroup>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                    <col>
                  </colgroup>
                </ng-template>
                <ng-template pTemplate="header">
                  <tr>
                    <th data-qe-id="table-thead-purchase-order-number" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.purchaseOrderNumber' | translate}} </th>
                    <th data-qe-id="table-thead-item-no" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.itemNo' | translate}} </th>
                    <th data-qe-id="table-thead-purchase-order-number" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.itemName' | translate}} </th>
                    <th data-qe-id="table-thead-unit-of-measure" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.unitOfMeasure' | translate}}
                    </th>
                    <th data-qe-id="table-thead-quantity" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.quantity' | translate}} </th>
                    <th data-qe-id="table-thead-unit-of-measure" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.unitPrice' | translate}}
                    </th>
                    <th data-qe-id="table-thead-value-added-tax" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.valueAddedTax' | translate}}
                      (%)
                    </th>
                    <th data-qe-id="table-thead-discount" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.discount' | translate}} (%)
                    </th>
                    <th data-qe-id="table-thead-discount-amount" pResizableColumn>
                      {{'goodsReceiptPODetail.tab1.discountAmount' | translate}}
                    </th>
                    <th width="8%">
                      {{'goodsReceiptPODetail.tab1.total' | translate}}
                    </th>
                  </tr>
                  <tr>
                    <th class="th-filter">
                      <app-single-select (listOpen)="dropListDocumentNumber(documentNumberSearchEntity.id)"
                                         (search)="typingSearchDocumentNumber($event, documentNumberSearchEntity.id)" (selectionChange)="documentNumberSearchEntity.id = $event[0];"
                                         [key]="'documentNumber'"
                                         [list]="documentNumberExceptIds"
                                         [selectedList]="documentNumberIds"
                                         data-qe-id="table-thead-filter-uom">
                      </app-single-select>
                    </th>
                    <th class="th-filter">
                      <app-single-select (listOpen)="dropListItemDetail(itemDetailSearchEntity.id)"
                                         (search)="typingSearchItemDetail($event, itemDetailSearchEntity.id)" (selectionChange)="itemDetailSearchEntity.id = $event[0]; tableGoodsReceiptPOContents.filter($event[0], 'itemId', 'equals')"
                                         [key]="'code'"
                                         [list]="itemDetailExceptIds"
                                         [selectedList]="itemDetailIds"
                                         data-qe-id="table-thead-filter-uom">
                      </app-single-select>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'itemName', 'contains')" class="form-control w-100"
                             type="text"/>
                    </th>
                    <th class="th-filter">
                      <app-single-select (listOpen)="dropListUnitOfMeasure(unitOfMeasureSearchEntity.id)"
                                         (search)="typingSearchUnitOfMeasure($event, unitOfMeasureSearchEntity.id)" (selectionChange)="unitOfMeasureSearchEntity.id = $event[0]; tableGoodsReceiptPOContents.filter($event[0], 'unitOfMeasureId', 'equals')"
                                         [key]="'name'"
                                         [list]="unitOfMeasureExceptIds"
                                         [selectedList]="unitOfMeasureIds"
                                         data-qe-id="table-thead-filter-uom">
                      </app-single-select>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'quantity', 'equals')" class="form-control w-100" pKeyFilter="int"
                             type="text"/>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'taxRate', 'equals')" class="form-control w-100" pKeyFilter="int"
                             type="text"/>
                    </th>
                    <th class="th-filter">
                      <app-single-select (listOpen)="dropListTax(taxSearchEntity.id)" (search)="typingSearchTax($event, taxSearchEntity.id)"
                                         (selectionChange)="taxSearchEntity.id = $event[0]; tableGoodsReceiptPOContents.filter($event[0], 'taxId', 'equals')" [key]="'code'"
                                         [list]="taxExceptIds"
                                         [selectedList]="taxIds"
                                         data-qe-id="table-thead-filter-uom">
                      </app-single-select>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'generalDiscountRate', 'equals')" class="form-control w-100" pKeyFilter="int"
                             type="text"/>
                    </th>
                    <th class="th-filter">
                      <input (input)="tableGoodsReceiptPOContents.filter($event.target.value, 'generalDiscountCost', 'equals')" class="form-control w-100" pKeyFilter="int"
                             type="text"/>
                    </th>
                    <th class="th-filter" width="8%"></th>
                  </tr>
                </ng-template>
                <ng-template let-goodsReceiptPOContent let-index="rowIndex" pTemplate="body">
                  <tr>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.documentNumber}}</td>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.itemCode}}</td>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.itemName}}</td>
                    <td class="ui-resizable-column">{{goodsReceiptPOContent.unitOfMeasureName}}</td>
                    <td class="ui-resizable-column">
                      {{goodsReceiptPOContent.quantity}}
                    </td>
                    <td class="ui-resizable-column text-right">{{goodsReceiptPOContent.unitPrice}}
                    </td>
                    <td class="ui-resizable-column text-right">{{goodsReceiptPOContent.taxRate}}
                    </td>
                    <td class="ui-resizable-column text-right">
                      {{goodsReceiptPOContent.generalDiscountRate}}
                    </td>
                    <td class="ui-resizable-column text-right">
                      {{goodsReceiptPOContent.generalDiscountCost}}
                    </td>
                    <td class="text-right" width="8%">
                      {{goodsReceiptPOContent.total}}
                    </td>
                  </tr>
                </ng-template>
                <ng-template let-columns pTemplate="footer">
                  <tr>
                    <td class="text-right" colspan="9">{{'general.text.total' | translate}}:</td>
                    <td class="text-right" width="8%">
                      {{ goodsReceiptPOForm.controls.totalGoodsReceiptPOContents.value | number}}
                    </td>
                  </tr>
                </ng-template>
              </p-table>
            </div>
          </mat-tab>
          <mat-tab label="{{'goodsReceiptPODetail.tab2.title' | translate}}">
            <div class="tab-upload">
              <div class="form-upload-file d-flex">
                <div class="pt-3 upload-btn-wrapper">
                  <button class="btn btn-labeled btn-import">
                    <span class="btn-label"><i class="material-icons">attach_file</i></span>
                    <span class="button-label">
                                            {{'general.button.attachFile' | translate}}
                                        </span></button>
                  <input (change)="readURL($event)" multiple type="file"/>
                </div>
                <div class="results d-flex align-items-center">
                  <div *ngFor="let name of fileNameList" class="results-item d-flex mr-3">
                    <div class="results-item-name">
                      <span class="icon-upload"><i class="material-icons">attach_file</i></span>
                      <span>{{name}}</span>
                    </div>
                    <span class="close-attach align-items-center"><i
                      class="material-icons">close</i></span>
                  </div>
                </div>
              </div>
            </div>
          </mat-tab>
        </mat-tab-group>
      </div>
    </div>

    <div *ngIf="goodsReceiptPOId !== null && goodsReceiptPOId !== undefined" class="page-section">
      <div class="page-section-form-header">
                <span class="form-title">
                    {{'goodsReceiptPODetail.form.post.title' | translate}}
                </span>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <app-discussion [discussionId]="goodsReceiptPOId"></app-discussion>
      </div>
    </div>
  </div>
</div>
