<div class="page goods-receipt-po">
  <div class="page-header justify-content-between">
    <div class="justify-content-start align-items-center">
        <span (click)="backToList()" class="back-to-list">
            <i class="material-icons">arrow_back_ios</i>
        </span>
      <span class="page-title">
          {{pageTitle | translate}}
      </span>
      <span class="ml-2 pending-receive-status">{{'general.pendingReceive'| translate}}</span>
    </div>

    <div class="page-actions d-flex">
      <button (click)="receive()" class="btn btn-labeled btn-receive" data-qe-id="button-receive">
        <span class="btn-label"><i class="material-icons">assignment_returned</i></span>
        <span class="button-label">
            {{'general.button.receive' | translate}}
        </span>
      </button>
      <button (click)="reject()" class="btn btn-labeled btn-rejected" data-qe-id="button-rejected">
        <span class="btn-label"><i class="material-icons">block</i></span>
        <span class="button-label">
            {{'general.button.rejected' | translate}}
        </span>
      </button>
      <div class="btn-group btn-labeled" data-qe-id="button-action" dropdown>
        <button aria-controls="dropdown-basic" class="btn btn-labeled btn-import" dropdownToggle id="button-basic">
          <span class="btn-label"><i class="material-icons">arrow_drop_down</i></span>
          <span class="button-label">
              {{'general.action' | translate}}
          </span></button>
        <ul *dropdownMenu aria-labelledby="button-basic" class="dropdown-menu dropdown-menu-right" id="dropdown-basic"
            role="menu">
          <li role="menuitem">
            <a class="dropdown-item btn btn-link" role="button">{{'general.button.history' | translate}}</a>
          </li>
          <li class="divider dropdown-divider"></li>
          <li role="menuitem">
            <a class="dropdown-item btn btn-link" role="button">{{'general.button.print' | translate}}</a>
          </li>
          <li class="divider dropdown-divider"></li>
          <li role="menuitem">
            <a class="dropdown-item btn btn-link" role="button">{{'general.button.referenceDocument' | translate}}</a>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div [formGroup]="goodsReceiptPOForm" class="page-body">
    <div class="page-section">
      <div class="page-section-form-header">
        <span class="form-title">
            {{'goodsReceiptPO.form.title' | translate}}
        </span>
        <div class="page-actions justify-content-end">
        </div>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-4 form-group">
            <label for="detail-form-supplierCode">
              {{'goodsReceiptPO.supplierCode' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-supplierCode"
                   formControlName="supplierCode"
                   id="detail-form-supplierCode"
                   type="text"/>
          </div>
          <div class="col-sm-4 form-group">
            <label for="detail-form-supplierName">
              {{'goodsReceiptPO.supplierName' | translate}}
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-supplierName"
                   formControlName="supplierName"
                   id="detail-form-supplierName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label for="detail-form-supplierAddress">
              {{'goodsReceiptPO.supplierAddress' | translate}}
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-supplierAddress"
                   formControlName="supplierAddress"
                   id="detail-form-supplierAddress"
                   type="text"/>
          </div>
        </div>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-8 form-group">
            <label for="detail-form-purchaseOrderName">
              {{'goodsReceiptPO.goodsReceipt.title' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-purchaseOrderName"
                   formControlName="purchaseOrderName"
                   id="detail-form-purchaseOrderName"
                   type="text">
          </div>
        </div>
      </div>
      <div class="line"></div>
      <div class="page-section-form-body">
        <div class="row">
          <div class="col-sm-4 form-group">
            <label for="detail-form-documentNumber">
              {{'goodsReceiptPO.purchaseOrderNumber' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-documentNumber"
                   formControlName="documentNumber"
                   id="detail-form-documentNumber"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label for="detail-form-inventoryOrganizationCode">
              {{'goodsReceiptPO.inventoryCode' | translate}}
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-inventoryOrganizationCode"
                   formControlName="inventoryOrganizationCode"
                   id="detail-form-inventoryOrganizationCode"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label for="detail-form-inventoryOrganizationStreet">
              {{'goodsReceiptPO.inventoryAddress' | translate}}
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-inventoryOrganizationStreet"
                   formControlName="inventoryOrganizationStreet"
                   id="detail-form-inventoryOrganizationStreet"
                   type="text">
          </div>
        </div>
        <div class="row">
          <div class="col-sm-4 form-group">
            <label for="detail-form-ownerName">
              {{'goodsReceiptPO.personInCharge' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-ownerName"
                   formControlName="ownerName"
                   id="detail-form-ownerName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label for="detail-form-buyerName">
              {{'goodsReceiptPO.receiver' | translate}}
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-buyerName"
                   formControlName="buyerName"
                   id="detail-form-buyerName"
                   type="text">
          </div>
          <div class="col-sm-4 form-group">
            <label for="detail-form-creator">
              {{'goodsReceiptPO.creator' | translate}}
            </label>
            <input class="form-control disabled"
                   data-qe-id="detail-form-creator"
                   formControlName="requesterName"
                   id="detail-form-creator"
                   type="text">
          </div>
        </div>
        <div class="row">

          <div class="col-sm-4 form-group">
            <label for="due-date">
              {{'goodsReceiptPO.receiptedDate' | translate}}
              <span class="text-danger mr-2">*</span>
            </label>
            <app-date-picker [control]="dueDate"
                             [disabled]="true"
                             data-qe-id="detail-form-receipted-date" id="due-date">
            </app-date-picker>
          </div>
          <div class="col-sm-4 form-group">
            <label for="document-date">
              {{'goodsReceiptPO.createdDate' | translate}}
            </label>
            <app-date-picker [control]="documentDate"
                             [disabled]="true"
                             data-qe-id="detail-form-created-date" id="document-date">
            </app-date-picker>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-12 form-group">
            <label for="detail-form-remarks">{{ 'goodsReceiptPO.description' | translate}}</label>
            <textarea class="form-control disabled"
                      data-qe-id="detail-form-remarks"
                      formControlName="remarks"
                      id="detail-form-remarks"
                      rows="4">
                        </textarea>
          </div>
        </div>
      </div>
    </div>
    <div class="page-section">
      <nz-tabset>
        <nz-tab nzTitle="{{'goodsReceiptPO.goodsReceiptPOContents.title' | translate}}">
          <div class="page-actions d-flex justify-content-end mb-2">
            <button (click)="clearTable(goodsReceiptPOContentsTable)"
                    class="btn btn-labeled btn-clear mr-2"
                    data-qe-id="button-clear">
          <span class="btn-label">
            <img src="/assets/img/filter.svg" width="16">
          </span>
              <span class="button-label">
            {{'general.button.clear' | translate}}
          </span>
            </button>
          </div>

          <p-table #goodsReceiptPOContentsTable
                   [resizableColumns]="true"
                   [rowTrackBy]="trackByFn"
                   [scrollable]="true"
                   [value]="goodsReceiptPOForm.value.goodsReceiptPOContents"
                   formArrayName="goodsReceiptPOContents"
                   scrollHeight="500px">
            <ng-template pTemplate="colgroup">
              <colgroup>
                <col>
                <col>
                <col>
                <col>
                <col>
                <col>
                <col>
              </colgroup>
            </ng-template>
            <ng-template pTemplate="header">
              <tr>
                <th data-qe-id="table-thead-purchase-order-number" pResizableColumn>
                  {{'goodsReceiptPO.goodsReceiptPOContents.purchaseOrderNumber' | translate}}
                </th>
                <th data-qe-id="table-thead-item-no" pResizableColumn>
                  {{'goodsReceiptPO.goodsReceiptPOContents.itemNo' | translate}}
                </th>
                <th data-qe-id="table-thead-purchase-order-number" pResizableColumn>
                  {{'goodsReceiptPO.goodsReceiptPOContents.itemName' | translate}}
                </th>
                <th data-qe-id="table-thead-unit-of-measure" pResizableColumn>
                  {{'goodsReceiptPO.goodsReceiptPOContents.unitOfMeasure' | translate}}
                </th>
                <th data-qe-id="table-thead-quantity" pResizableColumn>
                  {{'goodsReceiptPO.goodsReceiptPOContents.quantity' | translate}}
                </th>
                <th data-qe-id="table-thead-actualReceive" pResizableColumn>
                  {{'goodsReceiptPO.goodsReceiptPOContents.actualReceive' | translate}}
                </th>
                <th data-qe-id="table-thead-view-detail" pResizableColumn>
                  {{'general.detail' | translate}}
                </th>
              </tr>
              <tr>
                <th class="th-filter">
                  <app-advanced-filters [filter]="goodsReceiptPOContentSearchEntity.purchaseOrderNumber"
                                        defaultType="startsWith"
                                        (changeFilter)="onFilterPurchaseOrder(goodsReceiptPOContentsTable)"
                  ></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters [filter]="goodsReceiptPOContentSearchEntity.itemCode"
                                        defaultType="startsWith"
                                        (changeFilter)="onFilterItemCode(goodsReceiptPOContentsTable)"
                  ></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters [filter]="goodsReceiptPOContentSearchEntity.itemName"
                                        defaultType="contains"
                                        (changeFilter)="onFilterItemName(goodsReceiptPOContentsTable)"
                  ></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters [filter]="goodsReceiptPOContentSearchEntity.unitOfMeasureCode"
                                        (changeFilter)="onFilterUnitOfMeasureCode(goodsReceiptPOContentsTable)"
                  ></app-advanced-filters>
                </th>
                <th class="th-filter"></th>
                <th class="th-filter"></th>
                <th class="th-filter"></th>
              </tr>
            </ng-template>
            <ng-template let-goodsReceiptPOContent let-index="rowIndex" pTemplate="body">
              <tr [formGroupName]='index'>
                <td class="ui-resizable-column">{{goodsReceiptPOContent.purchaseOrderNumber}}</td>
                <td class="ui-resizable-column">{{goodsReceiptPOContent.itemCode}}</td>
                <td class="ui-resizable-column">{{goodsReceiptPOContent.itemName}}</td>
                <td class="ui-resizable-column">{{goodsReceiptPOContent.unitOfMeasureName}}</td>
                <td class="ui-resizable-column">{{goodsReceiptPOContent.quantity}}</td>
                <td class="ui-resizable-column">{{goodsReceiptPOContent.actualReceive}}</td>
                <td>
                  <a *ngIf="goodsReceiptPOContent.itemManagementTypeName === 'BATCH'"
                     (click)="showBatch(goodsReceiptPOContent)" class="btn btn-link" role="button">
                    {{'goodsReceiptPO.goodsReceiptPOContents.batches' | translate}}
                  </a>
                  <a *ngIf="goodsReceiptPOContent.itemManagementTypeName === 'SERIAL_NUMBER'"
                     (click)="showSerialNumber(goodsReceiptPOContent)" class="btn btn-link" role="button">
                    {{'goodsReceiptPO.goodsReceiptPOContents.SerialNumber' | translate}}
                  </a>
                  <a *ngIf="goodsReceiptPOContent.itemManagementTypeName === 'QUANTITY'"
                     (click)="showQuantity(goodsReceiptPOContent)" class="btn btn-link" role="button">
                    {{'goodsReceiptPO.goodsReceiptPOContents.quantity' | translate}}
                  </a>
                </td>
              </tr>
            </ng-template>
          </p-table>
        </nz-tab>
        <nz-tab nzTitle="{{'goodsReceiptPO.goodsReceiptPOAttachments.title' | translate}}">
          <div class="row">
            <div class="col">
              <ul class="list-group">
                <li class="list-group-item" *ngFor="let file of fileAttachments.value">
                  {{file.filename}}
                </li>
              </ul>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <nz-upload [nzDisabled]="true"
                         [nzLimit]="0"
                         [nzMultiple]="true"
                         nzType="drag">
                <p class="ant-upload-drag-icon">
                  <i nz-icon nzType="upload"></i>
                </p>
                <p class="ant-upload-text">
                  {{'goodsReceiptPO.attachments.title' | translate}}
                </p>
                <p class="ant-upload-hint">
                  {{'goodsReceiptPO.attachments.description' | translate}}
                </p>
              </nz-upload>
              <div class="d-flex justify-content-start mt-2">
                <button class="btn btn-labeled btn-send mr-2" disabled>
                    <span class="btn-label">
                      <i class="material-icons">cloud_upload</i>
                    </span>
                  <span class="button-label">
                      {{'general.button.upload' | translate}}
                    </span>
                </button>

                <button (click)="showAttachments()" class="btn btn-labeled btn-send">
                    <span class="btn-label">
                      <i class="material-icons">cloud_upload</i>
                    </span>
                  <span class="button-label">
                      {{'general.button.uploaded' | translate}} ({{fileAttachments.value.length}})
                    </span>
                </button>
              </div>
            </div>
          </div>
        </nz-tab>
      </nz-tabset>
    </div>
  </div>
</div>

<app-batch-dialog [(display)]="displayBatch"
                  [itemDetailId]="goodsReceiptPOContentId"
                  [updateBatch]="updateBatch"
                  [goodsReceiptPOContentId]="goodsReceiptPOContentId"
                  [enableBinLocation]="enableBinLocation?.value"
></app-batch-dialog>

<app-quantity-dialog [(display)]="displayQuantity"
                     [itemDetailId]="goodsReceiptPOContentId"
                     [updateQuantity]="updateBatch"
                     [goodsReceiptPOContentId]="goodsReceiptPOContentId"
                     [enableBinLocation]="enableBinLocation?.value"
></app-quantity-dialog>
