<p-dialog [(visible)]="display"
          [modal]="true"
          appendTo="body"
          [style]="{width: '90%'}"
          [responsive]="true">
  <p-header>
    <div class="col d-flex">
      <div class="flex-grow-1">
        <span class="dialog-header">
          {{'goodsReceiptPODetail.batches.title ' | translate}}
        </span>
      </div>
      <div class="flex-shrink-1 d-flex">
        <button (click)="clearTable(tableBatch)"
                class="btn btn-labeled btn-clear mr-2"
                data-qe-id="button-clear">
          <span class="btn-label">
            <img src="/assets/img/filter.svg" width="16">
          </span>
          <span class="button-label">
            {{'general.button.clear' | translate}}
          </span>
        </button>
        <button class="btn btn-labeled btn-import mr-2">
          <span class="btn-label">
            <img src="/assets/img/import.svg" width="24" alt="">
          </span>
          <span class="button-label">
            {{'general.button.import' | translate}}
          </span>
        </button>
        <button class="btn btn-labeled btn-export mr-2">
          <span class="btn-label">
            <img src="/assets/img/export.svg" width="24">
          </span>
          <span class="button-label">
            {{'general.button.export' | translate}}
          </span>
        </button>
        <button (click)="deleteSelected()" class="btn btn-labeled btn-delete">
          <span class="btn-label">
            <i class="material-icons">delete</i>
          </span>
          <span class="button-label">
              {{'general.button.delete' | translate}}
          </span>
        </button>
      </div>
    </div>
  </p-header>

  <div class="row my-2">
    <div class="col-6">
      <div class="d-flex align-items-center">
        <p-inputSwitch [(ngModel)]="activeScan"></p-inputSwitch>
        <label class="ml-2" for="dialog-input-start-qr-code">
          {{'goodsReceiptPODetail.qrCode.scanQRCode' | translate}}
        </label>
        <div class="ml-2">
          <input (input)="inputBatch(itemDetailId, $event)"
                 [disabled]="!activeScan"
                 class="form-control form-control-sm"
                 data-qe-id="dialog-input-start-scan-batches-no"
                 id="dialog-input-start-qr-code"
                 type="text">
        </div>
      </div>
    </div>
    <div class="col-6">
      <div class="d-flex align-items-center justify-content-end">
        <span class="mr-2">{{'goodsReceiptPODetail.binLocation' | translate}}: </span>
        <jaja-select-list [getList]="batchDialogRepository.getBinLocationList"
                          [searchable]="true"
                          [searchEntity]="binLocationSearchEntity"
                          searchField="code"
                          [display]="null"
                          [small]="true"
                          placeholder="{{'goodsReceiptPODetail.binLocation' | translate}}">
          <ng-template #label #option let-code="code">
            {{code}}
          </ng-template>
        </jaja-select-list>
      </div>
    </div>
    <div class="col-6 offset-6 mt-2 d-flex align-items-center justify-content-end">
      <label for="dialog-input-start-scan-batches-no" class="ml-2">
        {{'goodsReceiptPODetail.totalItems' | translate}}:
      </label>
      <div class="ml-2">
        <input [value]="batch.goodsReceiptPOBatches?.length"
               readonly
               class="form-control form-control-sm"
               data-qe-id="dialog-input-start-scan-batches-no"
               id="dialog-input-start-scan-batches-no"
               pKeyFilter="int"
               type="text">
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col form-group">
        <label for="batch-item-code">
          {{'goodsReceiptPO.batch.itemCode'}}
        </label>
        <input type="text" class="form-control" readonly [value]="batch.itemCode" id="batch-item-code">
      </div>

      <div class="col form-group">
        <label for="batch-item-name">
          {{'goodsReceiptPO.batch.itemName'}}
        </label>
        <input type="text" class="form-control" readonly [value]="batch.itemName" id="batch-item-name">
      </div>
    </div>
  </div>

  <p-table #tableBatch
           [resizableColumns]="true"
           [scrollable]="true"
           [value]="batch.goodsReceiptPOBatches"
           scrollHeight="300px">
    <ng-template pTemplate="colgroup">
      <colgroup>
        <col>
        <col>
        <col>
        <col>
        <col>
        <col>
      </colgroup>
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th [ngStyle]="{width: '4em'}"></th>
        <th data-qe-id="table-thead-batches-check-box" pResizableColumn [ngStyle]="{width: '4em'}">
          <div class="pretty p-icon p-curve p-has-indeterminate">
            <input (change)="selectAll($event)" type="checkbox"/>
            <div class="state">
              <i class="icon material-icons">done</i>
              <label></label>
            </div>
          </div>
        </th>
        <th data-qe-id="table-thead-qrCode" pResizableColumn>
          {{'goodsReceiptPODetail.batches.qrCode' | translate}}
        </th>
        <th data-qe-id="table-thead-batches-code" pResizableColumn>
          {{'goodsReceiptPODetail.batches.batchCode' | translate}}
        </th>
        <th data-qe-id="table-thead-batches-manufacturing-date" pResizableColumn>
          {{'goodsReceiptPODetail.batches.manufacturingDate' | translate}}
        </th>
        <th data-qe-id="table-thead-batches-expiry-date" pResizableColumn>
          {{'goodsReceiptPODetail.batches.expiryDate' | translate}}
        </th>
        <th data-qe-id="table-thead-batches-quantity-in-each-batch" pResizableColumn>
          {{'goodsReceiptPODetail.batches.quantityInEachBatch' | translate}}
        </th>
        <th data-qe-id="table-thead-batches-bin-location-code" pResizableColumn>
          {{'goodsReceiptPODetail.batches.binLocationCode' | translate}}
        </th>
        <th data-qe-id="table-thead-batches-quantity" pResizableColumn>
          {{'goodsReceiptPODetail.batches.binQuantity' | translate}}
        </th>
        <th data-qe-id="table-thead-batches-quantity" pResizableColumn>
          {{'goodsReceiptPODetail.batches.actions' | translate}}
        </th>
      </tr>
      <tr>
        <th [ngStyle]="{width: '4em'}">
        </th>
        <th [ngStyle]="{width: '4em'}">
        </th>
        <th class="th-filter"></th>
        <th class="th-filter">
          <app-advanced-filters [filter]="batchCode"
                                (changeFilter)="onFilterItemDetail(tableBatch)"></app-advanced-filters>
        </th>
        <th class="th-filter">
          <app-advanced-filters [filter]="mfrDateFilter"
                                (changeFilter)="onFilterItemDetail(tableBatch)"></app-advanced-filters>
        </th>
        <th class="th-filter">
          <app-advanced-filters [filter]="expirationDateFilter"
                                (changeFilter)="onFilterItemDetail(tableBatch)"></app-advanced-filters>
        </th>
        <th class="th-filter"></th>
        <th class="th-filter"></th>
        <th class="th-filter"></th>
        <th class="th-filter"></th>
      </tr>
    </ng-template>
    <ng-template let-batch let-indexRow="rowIndex" let-expanded="expanded" pTemplate="body">
      <tr>
        <td>
          <a href="#" [pRowToggler]="rowData">
            <i [ngClass]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'"></i>
          </a>
        </td>
        <td colspan="batch.goodsReceiptPOBatchBinLocations.length">
          <div class="pretty p-icon p-curve p-has-indeterminate">
            <input [(ngModel)]="batch.isSelected" type="checkbox"/>
            <div class="state">
              <i class="icon material-icons">done</i>
              <label></label>
            </div>
          </div>
        </td>
        <td class="ui-resizable-column" colspan="batch.goodsReceiptPOBatchBinLocations.length + 1">
          {{batch.qrCode}}
        </td>
        <td class="ui-resizable-column" colspan="batch.goodsReceiptPOBatchBinLocations.length + 1">
          {{batch.batchCode}}
        </td>
        <td class="ui-resizable-column" colspan="batch.goodsReceiptPOBatchBinLocations.length + 1">
          {{batch.mfrDate}}
        </td>
        <td class="ui-resizable-column" colspan="batch.goodsReceiptPOBatchBinLocations.length + 1">
          {{batch.expirationDate}}
        </td>
        <td class="ui-resizable-column" colspan="batch.goodsReceiptPOBatchBinLocations.length + 1">
          <input [(ngModel)]="batch.actualReceive" class="form-control form-control-sm" type="text"/>
        </td>
        <td [colSpan]="3">
        </td>
      </tr>
    </ng-template>
  </p-table>

  <p-footer>
    <div class="row">
      <div class="col-12 page-actions d-flex justify-content-end">
        <button (click)="updateBatch()" class="btn btn-labeled btn-save-dialog">
          <span class="btn-label"><i class="material-icons">save</i></span>
          <span class="button-label">
              {{'general.button.save' | translate}}
            </span>
        </button>
        <button (click)="display = false" class="btn btn-labeled btn-cancel">
          <span class="btn-label"><i class="material-icons"> highlight_off</i></span>
          <span class="button-label">
              {{'general.button.cancel' | translate}}
            </span>
        </button>
      </div>
    </div>
  </p-footer>
</p-dialog>
