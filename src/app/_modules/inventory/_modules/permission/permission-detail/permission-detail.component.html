<div class="page permission-detail">
  <div class="page-header">
    <div class="page-title">
      {{'permission.detail.title' | translate}}
      <span (click)="bookMark()">
        <mat-icon [ngClass]="!isBookMark ? 'save-book-mark': 'not-save-book-mark'"> star </mat-icon>
      </span>
    </div>
  </div>
  <div [formGroup]="permissionForm" class="page-body">
    <div class="page-section">
      <div class="d-flex justify-content-end">
        <button (click)="cancel()" class="btn btn-labeled btn-cancel mr-2">
          <span class="btn-label">
            <i class="material-icons">cancel</i>
          </span>
          <span class="button-label">
            {{'general.button.cancel' | translate}}
          </span>
        </button>
        <button (click)="save()" class="btn btn-labeled btn-save">
          <span class="btn-label">
            <i class="material-icons">save</i>
          </span>
          <span class="button-label">
            {{'general.button.save' | translate}}
          </span>
        </button>
      </div>
      <div class="row">
        <div class="col-4 form-group">
          <label for="position-code">
            {{'permission.positionCode' | translate}}
            <span class="text-danger ml-1">(*)</span>
          </label>
          <div class="div-form d-flex">
            <jaja-select-list (change)="onSelectPosition($event)"
                              [display]="positionCode?.value"
                              [getList]="permissionDetailRepository.getPositionList"
                              [searchEntity]="positionSearchEntity"
                              [searchable]="true"
                              class="flex-grow-1"
                              id="position-code"
                              placeholder="{{'permission.positionCode' | translate}}"
                              searchField="code"
                              searchType="startsWith">
              <ng-template #label #option let-code="code" let-name="name">
                {{code}} - {{name}}
              </ng-template>
            </jaja-select-list>
            <app-error *ngIf="(positionCode?.errors && positionCode?.touched) || !!errors?.get('positionCode')?.value"
                       [formGroup]="permissionForm"
                       [placement]="'top'" [property]="'positionCode'" class="error-form"
                       data-qe-id="dialog-error-code">
            </app-error>
          </div>
        </div>

        <div class="col-4 form-group">
          <label for="current-status">
            {{'permission.currentStatus' | translate}}
            <span class="text-danger ml-1">(*)</span>
          </label>
          <div class="div-form d-flex">
            <jaja-select-list [display]="currentStatusDisplay?.value"
                              [list]="documentStatus"
                              [renewOnOpen]="false"
                              class="flex-grow-1"
                              formControlName="currentStatusId"
                              id="current-status"
                              key="id"
                              placeholder="{{'permission.currentStatus' | translate}}">
              <ng-template #label #option let-display="display">
                {{display}}
              </ng-template>
            </jaja-select-list>
            <app-error
              *ngIf="(currentStatusId?.errors && currentStatusId?.touched) || !!errors?.get('currentStatusId')?.value"
              [formGroup]="permissionForm"
              [placement]="'top'" [property]="'currentStatusId'" class="error-form"
              data-qe-id="dialog-error-current-status">
            </app-error>
          </div>
        </div>

        <div class="col-4 form-group">
          <label for="next-status">
            {{'permission.nextStatus' | translate}}
            <span class="text-danger ml-1">(*)</span>
          </label>
          <div class="div-form d-flex">
            <jaja-select-list [display]="nextStatusDisplay?.value"
                              [list]="documentStatus"
                              [renewOnOpen]="false"
                              class="flex-grow-1"
                              formControlName="nextStatusId"
                              id="next-status"
                              key="id"
                              placeholder="{{'permission.nextStatus' | translate}}">
              <ng-template #label #option let-display="display">
                {{display}}
              </ng-template>
            </jaja-select-list>
            <app-error *ngIf="(nextStatusId?.errors && nextStatusId?.touched) || !!errors?.get('nextStatusId')?.value"
                       [formGroup]="permissionForm"
                       [placement]="'top'" [property]="'nextStatusId'" class="error-form"
                       data-qe-id="dialog-error-next-status">
            </app-error>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-4 offset-4 form-group">
          <label for="current-step">
            {{'permission.currentStep' | translate}}
            <span class="text-danger ml-1">(*)</span>
          </label>
          <div class="div-form">
            <input class="form-control" formControlName="currentStep" id="current-step" pKeyFilter="pnum"
                   placeholder="{{'permission.currentStep' | translate}}"
                   type="text">
            <app-error *ngIf="(currentStep?.errors && currentStep?.touched) || !!errors?.get('currentStep')?.value"
                       [formGroup]="permissionForm"
                       [placement]="'top'" [property]="'currentStep'" class="error-form"
                       data-qe-id="dialog-error-current-step">
            </app-error>
          </div>
        </div>

        <div class="col-4 form-group">
          <label for="next-step">
            {{'permission.nextStep' | translate}}
            <span class="text-danger ml-1">(*)</span>
          </label>
          <div class="div-form">
            <input class="form-control" formControlName="nextStep" id="next-step" pKeyFilter="pnum"
                   placeholder="{{'permission.nextStep' | translate}}"
                   type="text">
            <app-error *ngIf="(nextStep?.errors && nextStep?.touched) || !!errors?.get('nextStep')?.value"
                       [formGroup]="permissionForm"
                       [placement]="'top'" [property]="'nextStep'" class="error-form"
                       data-qe-id="dialog-error-next-step">
            </app-error>
          </div>
        </div>
      </div>
    </div>

    <div class="page-section">
      <div class="row">
        <div class="col">
          <label for="mail-to-sender">
            {{'permission.mailToSender' | translate}}
          </label>
          <p-editor [style]="{'height':'320px'}" formControlName="mailToSender" id="mail-to-sender"></p-editor>
        </div>
      </div>
    </div>

    <div class="page-section">
      <div class="row">
        <div class="col">
          <label for="mail-to-approver">
            {{'permission.mailToApprover' | translate}}
          </label>
          <p-editor [style]="{'height':'320px'}" formControlName="mailToApprover" id="mail-to-approver"></p-editor>
        </div>
      </div>
    </div>
  </div>

  <div class="page-section d-flex">
    <button (click)="confirmDeleting()" class="btn btn-labeled btn-delete mr-2">
      <span class="btn-label">
        <i class="material-icons">delete</i>
      </span>
      <span class="button-label">
        {{'general.button.delete' | translate}}
      </span>
    </button>
    <div class="flex-grow-1 d-flex justify-content-end">
      <button (click)="cancel()" class="btn btn-labeled btn-cancel mr-2">
          <span class="btn-label">
            <i class="material-icons">cancel</i>
          </span>
        <span class="button-label">
            {{'general.button.cancel' | translate}}
          </span>
      </button>
      <button (click)="save()" class="btn btn-labeled btn-save">
          <span class="btn-label">
            <i class="material-icons">save</i>
          </span>
        <span class="button-label">
            {{'general.button.save' | translate}}
          </span>
      </button>
    </div>
  </div>
</div>


<p-confirmDialog #cd
                 header="{{'general.confirmation.title' | translate}}"
                 message="{{'general.confirmation.message' | translate}}"
                 icon="pi pi-exclamation-triangle">
  <p-footer>
    <div class="d-flex justify-content-end">
      <button type="button" class="btn btn-labeled btn-cancel align-items-center" (click)="cd.reject()">
        <span class="button-label">
          {{'general.button.confirm.no' | translate}}
        </span></button>
      <button type="button" class="btn btn-labeled btn-reverse align-items-center" (click)="cd.accept()">
        <span class="button-label">
          {{'general.button.confirm.yes' | translate}}
        </span></button>
    </div>
  </p-footer>
</p-confirmDialog>
