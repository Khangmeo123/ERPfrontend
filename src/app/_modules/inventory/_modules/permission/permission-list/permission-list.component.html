<div class="page permission">
  <div class="page-header">
    <span class="page-title">
      {{pageTitle | translate}}
      <span (click)="bookMark()">
        <mat-icon [ngClass]="!isBookMark ? 'save-book-mark': 'not-save-book-mark'">
          star
        </mat-icon>
      </span>
    </span>
    <div class="page-actions d-flex">
      <button type="button"
              class="btn btn-labeled btn-add"
              (click)="add()"
              data-qe-id="button-add"
              [disabled]="!allSelected">
        <span class="btn-label"><i class="material-icons">add</i></span>
        <span class="button-label">
          {{'general.button.add' | translate}}
        </span></button>
      <button class="btn btn-labeled btn-clear" data-qe-id="button-clear" (click)="onClearSearch(table)">
        <span class="btn-label">
          <img src="/assets/img/filter.svg" width="16">
        </span>
        <span class="button-label">
          {{'general.button.clear' | translate}}
        </span>
      </button>
    </div>
  </div>
  <div class="page-body">
    <div class="page-section">
      <div class="row d-flex pb-3">
        <div class="col-sm-3 form-group">
          <label>
            {{'permission.inventoryCode' | translate}}
            <span class="text-danger mr-2">*</span>
          </label>
          <jaja-select-list [display]="inventoryOrganization?.code"
                            [getList]="permissionRepository.getInventoryOrganizationList"
                            [searchEntity]="inventoryOrganizationSearchEntity"
                            searchField="code"
                            searchType="startsWith"
                            [searchable]="true"
                            (change)="onSelectInventoryOrganization($event)"
                            placeholder="{{'permission.inventoryCode' | translate}}">
            <ng-template #label #option let-code="code">
              {{code}}
            </ng-template>
          </jaja-select-list>
        </div>
        <div class="col-sm-3 form-group">
          <label>
            {{'permission.documentType' | translate}}
            <span class="text-danger mr-2">*</span>
          </label>
          <jaja-select-list [display]="inventoryDocumentType?.display"
                            [getList]="permissionRepository.getInventoryDocumentTypes"
                            (change)="onSelectInventoryDocumentType($event)"
                            placeholder="{{'permission.documentType' | translate}}">
            <ng-template #label #option let-display="display">
              {{display}}
            </ng-template>
          </jaja-select-list>
        </div>
      </div>
    </div>
    <div class="page-section">
      <p-table [value]="permissionList"
               [customSort]="true"
               [scrollable]="true"
               scrollHeight="500px"
               [resizableColumns]="true"
               [lazy]="true"
               (onLazyLoad)="getList()"
               #table>
        <ng-template pTemplate="colgroup">
          <colgroup>
            <col>
            <col>
            <col>
            <col>
            <col>
            <col>
          </colgroup>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pResizableColumn data-qe-id="table-thead-positionCode">
              {{ 'permission.positionCode' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-positionName">
              {{ 'permission.positionName' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-step">
              {{ 'permission.currentStep' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>

            <th pResizableColumn data-qe-id="table-thead-currentStatus">
              {{ 'permission.currentStatus' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-inventory-address">
              {{ 'permission.nextStep' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-nextStatus">
              {{ 'permission.nextStatus' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th class="actions"></th>
          </tr>
          <tr>
            <th class="th-filter">
              <app-advanced-filters [filter]="permissionSearchEntity.positionCode"
                                    (changeFilter)="getList()"
                                    defaultType="startsWith"
              ></app-advanced-filters>
            </th>
            <th class="th-filter">
              <app-advanced-filters [filter]="permissionSearchEntity.positionName"
                                    (changeFilter)="getList()"
                                    defaultType="startsWith"
              ></app-advanced-filters>
            </th>
            <th class="th-filter">
              <app-advanced-filters [filter]="permissionSearchEntity.currentStep" (changeFilter)="getList()"
              ></app-advanced-filters>
            </th>
            <th class="th-filter">
              <jaja-select-list [list]="documentStatus"
                                [display]="permissionSearchEntity?.currentStatusDisplay"
                                [renewOnOpen]="false"
                                appendTo="body"
                                [value]="permissionSearchEntity?.currentStatusId"
                                [ngClass]="{disabled: !inventoryDocumentTypeId}"
                                (change)="onSelectCurrentDocumentStatus($event)"
                                placeholder="{{ 'permission.currentStatus' | translate}}">
                <ng-template #label #option let-display="display">
                  {{display}}
                </ng-template>
              </jaja-select-list>
            </th>
            <th class="th-filter">
              <app-advanced-filters [filter]="permissionSearchEntity.nextStep" (changeFilter)="getList()"
              ></app-advanced-filters>
            </th>
            <th class="th-filter">
              <jaja-select-list [list]="documentStatus"
                                [display]="permissionSearchEntity?.nextStatusDisplay"
                                [renewOnOpen]="false"
                                appendTo="body"
                                [value]="permissionSearchEntity?.nextStatusId"
                                [ngClass]="{disabled: !inventoryDocumentTypeId}"
                                (change)="onSelectNextDocumentStatus($event)"
                                placeholder="{{ 'permission.nextStatus' | translate}}">
                <ng-template #label #option let-display="display">
                  {{display}}
                </ng-template>
              </jaja-select-list>
            </th>
            <th class="th-filter actions"></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-index="index">
          <tr>
            <td>
              {{rowData.positionCode}}
            </td>
            <td>
              {{rowData.positionName}}
            </td>
            <td>
              {{rowData.currentStep}}
            </td>
            <td>
              {{rowData.currentStatusDisplay}}
            </td>
            <td>
              {{rowData.nextStep}}
            </td>
            <td>
              {{rowData.nextStatusDisplay}}
            </td>
            <td class="actions">
              <a role="button" (click)="edit(rowData)">
                <mat-icon>edit</mat-icon>
              </a>
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div class="pagination">
        <app-pagination [pagination]="pagination" (paginationOut)="onPaginate($event)"></app-pagination>
      </div>
    </div>
  </div>
</div>
