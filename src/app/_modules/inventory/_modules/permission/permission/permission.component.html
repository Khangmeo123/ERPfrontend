<div class="page permission">
  <div class="page-header">
    <span class="page-title">
      {{pageTitle | translate}}
      <span (click)="bookMark()">
        <mat-icon [ngClass]="!isBookMark ? 'save-book-mark': 'not-save-book-mark'">
          star
        </mat-icon>
      </span>
    </span>
  </div>
  <div class="page-body">
    <div class="page-section">
      <div class="row d-flex pb-3">
        <div class="col-sm-4 form-group">
          <label>
            {{'permission.legalEntity' | translate}}
            <span class="text-danger mr-2">*</span>
          </label>
          <app-single-select data-qe-id="form-select-legalEntity"
                             [list]="legalEntities.exceptIds"
                             [selectedList]="legalEntities.ids"
                             [initialValue]="legalEntity?.name"
                             (selectionChange)="onSelectLegalEntity($event)"
                             (listOpen)="getLegalEntityList()"
                             key="name"
                             [valueSelector]="nodeSelector"
                             (search)="onSearchLegalEntity($event)"
          ></app-single-select>
        </div>
        <div class="col-sm-4 form-group">
          <label>
            {{'permission.inventoryCode' | translate}}
            <span class="text-danger mr-2">*</span>
          </label>
          <app-single-select data-qe-id="form-select-inventoryCode"
                             [list]="inventoryOrganizationEntities.exceptIds"
                             [selectedList]="inventoryOrganizationEntities.ids"
                             [initialValue]="inventoryOrganization?.name"
                             (selectionChange)="onSelectInventoryOrganization($event)"
                             (listOpen)="getInventoryOrganizationList()"
                             key="name"
                             [valueSelector]="nodeSelector"
                             [disabled]="!legalEntity"
                             (search)="onSearchInventoryOrganization($event)"
          ></app-single-select>
        </div>
        <div class="col-sm-4 form-group">
          <label>
            {{'permission.documentType' | translate}}
            <span class="text-danger mr-2">*</span>
          </label>
          <app-simple-select data-qe-id="form-select-documentType"
                             [list]="inventoryDocumentTypes"
                             [initialValue]="inventoryDocumentType?.display"
                             (selectionChange)="onSelectInventoryDocumentType($event)"
                             (listOpen)="getDocumentList()"
                             key="display"
                             [valueSelector]="nodeSelector"
          ></app-simple-select>
        </div>
      </div>
    </div>
    <div class="page-section">
      <div class="d-flex justify-content-end mb-2">
        <button class="btn btn-add mr-2"
                [disabled]="!(legalEntity && inventoryDocumentType && inventoryOrganization)"
                (click)="add()"> {{'general.button.add' | translate}} </button>
        <button class="btn btn-primary" (click)="onClearSearch(table)">
          {{'general.button.clear' | translate}}
        </button>
      </div>
      <p-table [value]="permissionList"
               [customSort]="true"
               [scrollable]="true"
               scrollHeight="500px"
               [resizableColumns]="true"
               [lazy]="true"
               (onLazyLoad)="getList()"
               #table>
        <ng-template pTemplate="colgroup">
          <colgroup>
            <col>
            <col>
            <col>
            <col>
            <col>
            <col>
          </colgroup>
        </ng-template>
        <ng-template pTemplate="header">
          <tr>
            <th pResizableColumn data-qe-id="table-thead-positionCode">
              {{ 'permission.positionCode' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-positionName">
              {{ 'permission.positionName' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-step">
              {{ 'permission.currentStep' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>

            <th pResizableColumn data-qe-id="table-thead-currentStatus">
              {{ 'permission.currentStatus' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-inventory-address">
              {{ 'permission.nextStep' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th pResizableColumn data-qe-id="table-thead-nextStatus">
              {{ 'permission.nextStatus' | translate}}
              <p-sortIcon class="float-right"></p-sortIcon>
            </th>
            <th class="actions"></th>
          </tr>
          <tr>
            <th class="th-filter">
              <app-single-select key="code"
                                 [disabled]="!legalEntity"
                                 [valueSelector]="nodeSelector"
                                 (listOpen)="getPositionList()"
                                 (search)="onSearchPosition($event)"
                                 (selectionChange)="onSelectPosition($event)"
                                 [initialValue]="permissionSearchEntity.positionCode"
                                 [list]="positionEntities.exceptIds"
                                 [selectedList]="positionEntities.ids"
              ></app-single-select>
            </th>
            <th class="th-filter">
              <app-advanced-filters [filter]="permissionSearchEntity.positionName"
                                    (changeFilter)="getList()"
                                    defaultType="startsWith"
              ></app-advanced-filters>
            </th>
            <th class="th-filter">
              <app-advanced-filters [filter]="permissionSearchEntity.currentStep" (changeFilter)="getList()"
              ></app-advanced-filters>
            </th>
            <th class="th-filter">
              <app-simple-select [list]="documentStatus"
                                 (selectionChange)="onSelectCurrentDocumentStatus($event)"
                                 (listOpen)="getDocumentStatus(inventoryDocumentTypeId)"
                                 key="display"
                                 [valueSelector]="nodeSelector"
                                 [initialValue]="currentDocumentStatus?.display"
              ></app-simple-select>
            </th>
            <th class="th-filter">
              <app-advanced-filters [filter]="permissionSearchEntity.nextStep" (changeFilter)="getList()"
              ></app-advanced-filters>
            </th>
            <th class="th-filter">
              <app-simple-select [list]="documentStatus"
                                 (selectionChange)="onSelectNextDocumentStatus($event)"
                                 (listOpen)="getDocumentStatus(inventoryDocumentTypeId)"
                                 key="display"
                                 [valueSelector]="nodeSelector"
                                 [initialValue]="nextDocumentStatus?.display"
              ></app-simple-select>
            </th>
            <th class="th-filter actions"></th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-index="index">
          <tr>
            <td>
              {{rowData.positionCode}}
            </td>
            <td>
              {{rowData.positionName}}
            </td>
            <td>
              {{rowData.currentStep}}
            </td>
            <td>
              {{rowData.currentStatusDisplay}}
            </td>
            <td>
              {{rowData.nextStep}}
            </td>
            <td>
              {{rowData.nextStatusDisplay}}
            </td>
            <td class="actions">
              <a role="button" (click)="edit(rowData)">
                <mat-icon>edit</mat-icon>
              </a>
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div class="pagination">
        <app-pagination [pagination]="pagination" (paginationOut)="onPaginate($event)"></app-pagination>
      </div>
    </div>
  </div>
</div>
