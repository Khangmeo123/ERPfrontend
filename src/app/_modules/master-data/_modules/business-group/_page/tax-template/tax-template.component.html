<div class="page tax-template">
  <div class="page-header">
    <div class="page-title">
      {{'tax-template.title' | translate}}
    </div>

    <div class="page-actions">
      <button class="btn btn-add" (click)="add()" data-qe-id="button-add">
        + {{'general.button.add' | translate}}</button>

      <div class="btn-group" dropdown data-qe-id="button-import">
        <button id="button-basic" dropdownToggle type="button" class="btn btn-import dropdown-toggle"
                aria-controls="dropdown-basic">
          {{'general.button.import' | translate}}<span class="caret"></span>
        </button>
        <ul id="dropdown-basic" *dropdownMenu class="dropdown-menu" role="menu" aria-labelledby="button-basic">
          <li role="menuitem">
            <button class="dropdown-item"
                    (click)="file.click()">{{'general.button.importFile' | translate}}</button>
          </li>
          <li class="divider dropdown-divider"></li>
          <li role="menuitem"><a class="dropdown-item" target="_blank"
                                 [href]="downloadLink">{{'general.button.downloadTemplate' | translate}}</a>
          </li>
        </ul>
        <input type="file" accept=".xlsx" (click)="file.value = null" (change)="importTemplate(file.files)"
               #file hidden>
      </div>

      <a class="btn btn-export" data-qe-id="button-export" target="_blank"
         [href]="exportLink">{{'general.button.export' | translate}}</a>
      <button class="btn btn-clear" (click)="clearSearch(table)"
              data-qe-id="button-clear">{{'general.button.clear' | translate}}</button>
    </div>
  </div>

  <div class="page-body">
    <div class="page-section">
      <p-table [value]="taxTemplateList"
               [customSort]="true"
               [lazy]="true"
               (onLazyLoad)="sort($event)"
               [scrollable]="true"
               scrollHeight="500px"
               [resizableColumns]="true"
               #table>
        <ng-template pTemplate="header">
          <tr>
            <th class="code" pResizableColumn [pSortableColumn]="'code'" data-qe-id="table-thead-code">
              {{ 'tax-template.code' | translate}}
              <p-sortIcon [field]="'code'" class="float-right"></p-sortIcon>
            </th>
            <th class="type" pResizableColumn [pSortableColumn]="'type'" data-qe-id="table-thead-type">
              {{ 'tax-template.type' | translate}}
              <p-sortIcon [field]="'type'" class="float-right"></p-sortIcon>
            </th>
            <th class="name" pResizableColumn [pSortableColumn]="'name'" data-qe-id="table-thead-name">
              {{ 'tax-template.name' | translate}}
              <p-sortIcon [field]="'name'" class="float-right"></p-sortIcon>
            </th>
            <th class="actions">
            </th>
          </tr>
          <tr>
            <th class="th-filter code">
              <app-advanced-filters [filter]="taxTemplateSearchEntity.code"
                                    (changeFilter)="getList()"
              ></app-advanced-filters>
            </th>
            <th class="th-filter type">
              <app-simple-select [list]="typeList"
                                 [initialValue]="taxTemplateSearchEntity?.typeDisplay"
                                 (selectionChange)="onFilterTaxTemplateType($event)"
                                 [valueSelector]="taxTemplateTypeSelector"
                                 (listOpen)="taxTemplateService.getTypeList()"
                                 key="display"
              ></app-simple-select>
            </th>
            <th class="th-filter name">
              <app-advanced-filters [filter]="taxTemplateSearchEntity.name"
                                    (changeFilter)="getList()"
              ></app-advanced-filters>
            </th>
            <th class="th-filter actions">
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-rowData let-index="index">
          <tr>
            <td class="code">
              {{rowData.code}}
            </td>
            <td class="name">
              {{rowData.type}}
            </td>
            <td class="name">
              {{rowData.name}}
            </td>
            <td class="actions">
              <a role="button" (click)="edit(rowData)">
                <mat-icon>edit</mat-icon>
              </a>

              <a role="button" (click)="delete(rowData)">
                <mat-icon>edit</mat-icon>
              </a>
            </td>
          </tr>
        </ng-template>
      </p-table>
      <div class="pagination">
        <app-pagination [pagination]="pagination" (paginationOut)="paginationOut($event)"></app-pagination>
      </div>
    </div>
  </div>
</div>

<p-dialog [modal]="true"
          appendTo="body"
          [(visible)]="modal">
  <p-header>
    {{'tax-template.modal.title' | translate}}
  </p-header>

  <div class="container" [formGroup]="taxTemplateForm">
    <div class="row">
      <div class="col">
        <label for="tax-template-code">
          {{'tax-template.code' | translate}}
          <span class="text-danger ml-1">(*)</span>
        </label>
        <div class="div-form">
          <input type="text" class="form-control" id="tax-template-code" formControlName="code">
          <app-error data-qe-id="dialog-error-name"
                     *ngIf="(code?.errors && code?.touched) || !!errors.get('code')?.value"
                     [formGroup]="taxTemplateForm" [property]="'code'" [placement]="'top'" class="error-form">
          </app-error>
        </div>
      </div>

      <div class="col">
        <label for="tax-template-name">
          {{'tax-template.name' | translate}}
          <span class="text-danger ml-1">(*)</span>
        </label>
        <div class="div-form">
          <input type="text" class="form-control" id="tax-template-name" formControlName="name">
          <app-error data-qe-id="dialog-error-name"
                     *ngIf="(name?.errors && name?.touched) || !!errors.get('name')?.value"
                     [formGroup]="taxTemplateForm" [property]="'name'" [placement]="'top'" class="error-form">
          </app-error>
        </div>
      </div>
    </div>
  </div>

  <p-footer>
    <div class="row">
      <div class="col d-flex">
        <button class="btn btn-delete"
                mwlConfirmationPopover
                popoverTitle="{{'tax-template.delete.title' | translate}}"
                data-qe-id="dialog-button-delete"
                *ngIf="taxTemplateForm.value?.id"
                popoverMessage="{{'tax-template.delete.message' | translate}}"
                placement="bottom"
                (confirm)="delete(taxTemplateForm.value)">
          {{ 'general.button.delete' | translate}}</button>
        <div class="page-actions flex-grow-1">
          <button class="btn btn-cancel" (click)="cancel()">
            {{'general.button.cancel' | translate}}
          </button>
          <button class="btn btn-save" (click)="save()">
            {{'general.button.save' | translate}}
          </button>
        </div>
      </div>
    </div>
  </p-footer>
</p-dialog>
