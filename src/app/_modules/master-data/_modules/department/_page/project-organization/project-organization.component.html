<div class="row">
  <div class="col">
    <div class="page">

      <div class="page-header">
        <div class="page-title">
          {{'projectOrganization.title' | translate}}
        </div>
        <div class="page-actions">
          <button (click)="add()" [disabled]="disabled" class="btn btn-add">
            {{'general.button.add' | translate}}
          </button>
        </div>
      </div>

      <div class="page-body mt-2">
        <div class="page-section">
          <p-table #table
                   (onLazyLoad)="sort($event)"
                   (selectionChange)="onSelectDepartment($event)"
                   [(selection)]="selectedDepartment"
                   [customSort]="true"
                   [lazy]="true"
                   [resizableColumns]="true"
                   [scrollable]="true"
                   [value]="projectOrganizationList"
                   resizableColumns
                   scrollHeight="500px"
                   selectionMode="single">
            <ng-template pTemplate="header">
              <tr>
                <th pResizableColumn> {{'projectOrganization.code' | translate}} </th>
                <th pResizableColumn> {{'projectOrganization.name' | translate}} </th>
                <th pResizableColumn> {{'projectOrganization.manager' | translate}} </th>
                <th pResizableColumn> {{'projectOrganization.startDate' | translate}} </th>
                <th pResizableColumn> {{'projectOrganization.endDate' | translate}} </th>
              </tr>
              <tr>
                <th class="th-filter">
                  <app-advanced-filters defaultType="startsWith" (changeFilter)="getList()"
                                        [filter]="projectOrganizationSearchEntity.code"></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters defaultType="startsWith" (changeFilter)="getList()"
                                        [filter]="projectOrganizationSearchEntity.name"></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters defaultType="startsWith" (changeFilter)="getList()"
                                        [filter]="projectOrganizationSearchEntity.managerName"></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters (changeFilter)="getList()"
                                        [filter]="projectOrganizationSearchEntity.startDate"></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters (changeFilter)="getList()"
                                        [filter]="projectOrganizationSearchEntity.endDate"></app-advanced-filters>
                </th>
              </tr>
            </ng-template>

            <ng-template let-projectOrganization let-index let-rowData pTemplate="body">
              <tr (dblclick)="edit(projectOrganization.id)" [attr.data-qe-id]="'table-tbody-row-' + index"
                  [pSelectableRow]="rowData">
                <td pResizableColumn>{{projectOrganization.code}}</td>
                <td pResizableColumn>{{projectOrganization.name}}</td>
              </tr>
            </ng-template>
          </p-table>
          <div class="pagination">
            <app-pagination (paginationOut)="onPaginationChange($event)" [pagination]="pagination"></app-pagination>
          </div>
        </div>
      </div>
    </div>

    <p-dialog [(visible)]="modal" [modal]="true" appendTo="body">
      <p-header>
        {{'department.project.add' | translate}}
      </p-header>
      <div [formGroup]="projectOrganizationForm" class="container">
        <div class="row">
          <div class="form-group col">
            <label for="project-code">
              {{'department.project.code' | translate}}
              <span class="text-danger ml-2">*</span>
            </label>
            <div class="div-form">
              <input class="form-control" formControlName="code" id="project-code" name="code" type="text">
              <app-error *ngIf="(code?.errors && code?.touched) || !!errors.get('name')?.value"
                         [formGroup]="projectOrganizationForm"
                         [placement]="'top'" class="error-form" data-qe-id="hrOrganization-code" property="code">
              </app-error>
            </div>
          </div>
          <div class="form-group col">
            <label for="project-name">
              {{'department.project.name' | translate}}
              <span class="text-danger ml-2">*</span>
            </label>
            <div class="div-form">
              <input class="form-control" formControlName="name" id="project-name" name="name" type="text">
              <app-error *ngIf="(name?.errors && name?.touched) || !!errors.get('name')?.value"
                         [formGroup]="projectOrganizationForm"
                         [placement]="'top'" class="error-form" data-qe-id="hrOrganization-name" property="name">
              </app-error>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="form-group col">
            <label for="project-manager">
              {{'department.project.manager' | translate}}
              <span class="text-danger ml-2">*</span>
            </label>
            <div class="div-form d-flex">
              <app-single-select id="project-manager"
                                 class="flex-grow-1"
                                 (search)="onSearchManagerByTyping($event)"
                                 (listOpen)="onSearchManager()"
                                 [list]="managerList"
                                 key="name"
                                 [selectedList]="selectedManagerList"
                                 (selectionChange)="onSelectManager($event)"
              ></app-single-select>
              <app-error *ngIf="(managerId?.errors && managerId?.touched) || !!errors.get('managerId')?.value"
                         [formGroup]="projectOrganizationForm"
                         [placement]="'top'" class="error-form" data-qe-id="projectOrganization-managerId"
                         property="managerId">
              </app-error>
            </div>
          </div>
          <div class="form-group col">
            <label for="project-description">
              {{'department.project.description' | translate}}
            </label>
            <textarea id="project-description" formControlName="description" name="description" class="form-control"
                      rows="1"></textarea>
          </div>
        </div>
        <div class="row">
          <div class="form-group col">
            <label for="project-start-date">
              {{'department.project.startDate' | translate}}
            </label>
            <app-date-picker id="project-start-date" [control]="startDate"></app-date-picker>
          </div>
          <div class="form-group col">
            <label for="project-end-date">
              {{'department.project.endDate' | translate}}
            </label>
            <app-date-picker id="project-end-date" [control]="endDate"></app-date-picker>
          </div>
        </div>
      </div>
      <p-footer class="d-flex">
        <button *ngIf="projectOrganizationForm.value?.isDeleted" class="btn btn-delete">
          {{'general.button.delete' | translate}}
        </button>
        <div class="flex-grow-1">
          <button class="btn btn-cancel mr-2" (click)="cancel()">
            {{'general.button.cancel' | translate}}
          </button>
          <button (click)="save()" class="btn btn-add">
            {{'general.button.save' | translate}}
          </button>
        </div>
      </p-footer>
    </p-dialog>

  </div>
  <div class="col">
    <div class="page">

      <div class="page-header">
        <div class="page-title mr-2">
          <app-multi-select (listOpen)="onSearchEmployee()"
                            (search)="onSearchEmployeeByTyping($event)"
                            (selectionChange)="onSelectEmployeeToAdd($event)"
                            [disabled]="disabled"
                            [list]="employeeNotInDepartmentList"
                            [selectedList]="selectedEmployeeToAddToDepartmentList"
                            key="name"></app-multi-select>
        </div>
        <div class="page-actions">
          <button (click)="onAddToDepartment()"
                  [disabled]="disabled || !employeeNotInDepartmentSearchEntity?.ids?.length"
                  class="btn btn-add">
            {{'general.button.add' | translate}}
          </button>
          <button [disabled]="disabled" class="btn btn-import">
            {{'general.button.import' | translate}}
          </button>
          <button [disabled]="disabled" class="btn btn-export">
            {{'general.button.export' | translate}}
          </button>
        </div>
      </div>

      <div class="page-body mt-2">

        <div class="page-section">
          <p-table [value]="employeeList" resizableColumns>
            <ng-template pTemplate="header">
              <tr>
                <th pResizableColumn> {{'project.employee.code' | translate}} </th>
                <th pResizableColumn> {{'project.employee.name' | translate}} </th>
                <th pResizableColumn> {{'general.action' | translate}} </th>
              </tr>
              <tr>
                <th class="th-filter">
                  <app-advanced-filters defaultType="startsWith" (changeFilter)="getEmployeeList()"
                                        [filter]="employeeSearchEntity.code"></app-advanced-filters>
                </th>
                <th class="th-filter">
                  <app-advanced-filters defaultType="startsWith" (changeFilter)="getEmployeeList()"
                                        [filter]="employeeSearchEntity.code"></app-advanced-filters>
                </th>
                <th class="th-filter"></th>
              </tr>
            </ng-template>
            <ng-template let-employee pTemplate="body">
              <tr (dblclick)="onViewDetail(employee)">
                <td>{{employee.code}}</td>
                <td>{{employee.name}}</td>
                <td>
                  <a (confirm)="removeEmployee(employee.id)"
                     [popoverMessage]="'general.project.delete.message' | translate"
                     [popoverTitle]="'general.project.delete.title' | translate"
                     class="btn btn-default"
                     confirmButtonType="danger"
                     mwlConfirmationPopover
                     placement="left"
                     role="button">
                    {{'general.button.delete' | translate}}
                  </a>
                </td>
              </tr>
            </ng-template>
          </p-table>

          <div class="pagination">
            <app-pagination (paginationOut)="onPaginationChange(pagination)"
                            [pagination]="employeePagination"></app-pagination>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
